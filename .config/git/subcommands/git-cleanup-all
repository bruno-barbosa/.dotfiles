#!/usr/bin/env bash

# Delete all local branches except main/master and develop

# Get the main branch name (main or master)
_git_main_branch() {
  if git rev-parse --git-dir > /dev/null 2>&1; then
    for branch in main master; do
      if git show-ref -q --verify refs/heads/$branch; then
        echo $branch
        return
      fi
    done
    echo "main"
  fi
}

main_branch=$(_git_main_branch)
echo "⚠️  This will delete ALL local branches except $main_branch and develop"
read -p "Are you sure? (y/n) " -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]]; then
  git branch | \
    grep -v "^\*" | \
    grep -v "^  $main_branch$" | \
    grep -v "^  develop$" | \
    xargs -n 1 -r git branch -D
  echo "✓ All branches deleted!"
else
  echo "Cancelled."
fi
